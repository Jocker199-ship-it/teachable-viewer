<!DOCTYPE html>
<html lang="ru">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <meta charset="UTF-8" />
  <title>Teachable Machine: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏</title>
  <style>
    body {
      font-family: sans-serif;
    }
    #status {
      margin-top: 10px;
      font-weight: bold;
    }
    #results {
      margin-top: 10px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>
<body>
  <h1>Teachable Machine: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏</h1>
  <p>–í—ã–±–µ—Ä–∏—Ç–µ 3 —Ñ–∞–π–ª–∞, —Å–∫–∞—á–∞–Ω–Ω—ã–µ –∏–∑ Teachable Machine:</p>
  <ul>
    <li><strong>model.json</strong></li>
    <li><strong>metadata.json</strong></li>
    <li><strong>weights.bin</strong></li>
  </ul>

  <p>
    model.json: 
    <input type="file" id="model-json" accept=".json" />
  </p>
  <p>
    metadata.json: 
    <input type="file" id="metadata-json" accept=".json" />
  </p>
  <p>
    weights.bin: 
    <input type="file" id="weights-bin" accept=".bin" />
  </p>

  <button onclick="loadModel()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å</button>

  <div id="status">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏...</div>

  <h3>üì∑ –í–µ–±–∫–∞–º–µ—Ä–∞:</h3>
  <video id="webcam" autoplay playsinline width="224" height="224"></video>

  <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
  <div id="results"></div>

  <script>
    let model;
    let webcam;
    let isModelReady = false;

    async function loadModel() {
      const status = document.getElementById("status");
      status.textContent = "üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å...";

      const modelJsonFile = document.getElementById("model-json").files[0];
      const metadataJsonFile = document.getElementById("metadata-json").files[0];
      const weightsBinFile = document.getElementById("weights-bin").files[0];

      if (!modelJsonFile || !metadataJsonFile || !weightsBinFile) {
        status.textContent = "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ —Ç—Ä–∏ —Ñ–∞–π–ª–∞.";
        return;
      }

      const modelURL = URL.createObjectURL(modelJsonFile);
      const metadataURL = URL.createObjectURL(metadataJsonFile);
      const weightsURL = URL.createObjectURL(weightsBinFile);

      try {
        model = await tmImage.load(modelURL, metadataURL);
        isModelReady = true;
        status.textContent = "‚úÖ –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞.";

        await setupWebcam();
        startPrediction();
      } catch (error) {
        console.error(error);
        status.textContent = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: " + error.message;
      }
    }

    async function setupWebcam() {
      const flip = true;
      webcam = new tmImage.Webcam(224, 224, flip);
      await webcam.setup();
      await webcam.play();
      window.requestAnimationFrame(loop);
      document.getElementById("webcam").appendChild(webcam.canvas);
    }

    async function loop() {
      webcam.update();
      if (isModelReady) {
        await predict();
      }
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";
      prediction.forEach(p => {
        const line = document.createElement("div");
        line.textContent = `${p.className}: ${(p.probability * 100).toFixed(2)}%`;
        resultsDiv.appendChild(line);
      });
    }
  </script>
</body>
</html>
